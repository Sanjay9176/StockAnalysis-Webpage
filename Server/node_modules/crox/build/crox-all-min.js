/*!
 * Crox v2.0.0
 * https://github.com/thx/crox
 *
 * Released under the MIT license
 */

!function(root){var Crox=function(){function Class(e,r,t){function n(){}n.prototype=e.prototype;var i=new n;if(t)for(var u in t)i[u]=t[u];return r||(r=n),r.prototype=i,r}function Position(e,r){this.row=e,this.col=r}function getPos(e,r){var t=e.substring(0,r),n=t.match(/\r\n?|\n/g),i=1;return n&&(i+=n.length),new Position(i,1+/[^\r\n]*$/.exec(t)[0].length)}function Enum(e){for(var r={},t=0;t<e.length;++t)r[e[t]]=e[t];return r}function inArr(e,r){for(var t=0;t<e.length;++t)if(e[t]==r)return t;return-1}function inArr_strict(e,r){for(var t=0;t<e.length;++t)if(e[t]===r)return t;return-1}function nodup(e,r){r||(r=function(e,r){return e===r});for(var t=[],n=e.length,i=0;i<n;i++){for(var u=i+1;u<n;u++)r(e[i],e[u])&&(u=++i);t.push(e[i])}return t}function htmlEncode(e){return String(e).replace(/[&<>"]/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";default:return"&quot;"}})}function quote(e){return'"'+e.replace(/[\x00-\x1f"\\\u2028\u2029]/g,function(e){switch(e){case'"':return'\\"';case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t"}return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'}function singleQuote(e){return"'"+e.replace(/[\x00-\x1f'\\\u2028\u2029]/g,function(e){switch(e){case"'":return"\\'";case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t"}return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'"}function phpQuote(e){return"'"+String(e).replace(/['\\]/g,"\\$&")+"'"}function evalNum(e){return+e}function evalStr(s){return eval(s)}function encodeCommonName(e){return e.replace(/^_+/,"$&$&")}function createLexer(e){function g(e,r,t,n,i,u){this.tag=e,this.text=r,this.index=t,this.subMatches=n,this.end=i,this.pos=u}function o(){}function s(e){return"function"==typeof e?e:function(){return e}}function r(e){for(var r=1,t=[],n=[1],i=[],u=0;u<e.length;++u)n.push(r+=RegExp("|"+e[u][0].source).exec("").length),i.push(e[u][1]?s(e[u][1]):o),t.push("("+e[u][0].source+")");return[RegExp(t.join("|")+"|","g"),n,i]}g.prototype.toString=function(){return this.text};var d=e.$||"$",v={};for(var t in e)"$"!=t.charAt(0)&&(v[t]=r(e[t]));return function(s){var c=s.length,a=0,f=[""],l={text:"",index:0,source:s,pushState:function(e){f.push(e)},popState:function(){f.pop()},retract:function(e){a-=e}},p=new Position(1,1);function h(){var e=f[f.length-1],r=v[e],t=r[0];t.lastIndex=a;var n=t.exec(s);if(""==n[0]){if(a<c)throw Error("lexer error: "+p+"\n"+s.slice(a,a+50));return new g(d,"",a,null,a,p)}l.index=a,a=t.lastIndex;for(var i=r[1],u=0;u<i.length;++u)if(n[i[u]]){var o=r[2][u].apply(l,n.slice(i[u],i[u+1]));return new g(o,n[0],l.index,n.slice(i[u]+1,i[u+1]),a,p)}}var _=/\r\n?|\n/g;return{scan:function(){for(;;){var e=h(),r=p.row,t=p.col,n=e.text.match(_),i=n?n.length:0;if(r+=i,0==i)t+=e.text.length;else{for(var u,o=0,s=0,c=e.text.length;s<c;s++)"\r"!==(u=e.text.substr(s,1))&&"\n"!==u&&"\u2028"!==u&&"\u2029"!==u?o+=1:o=0;t=o+1}if(p=new Position(r,t),null!=e.tag)return e}},GetCurrentPosition:function(){return p},getPos:function(e){return getPos(s,e)}}}}Position.prototype.toString=function(){return"("+this.row+","+this.col+")"};var Lexer=(Qa=[[/\s+/],[/\/\/[^\r\n]*|\/\*[\s\S]*?\*\//],[/[A-Za-z_]\w*/,function(e){switch(e){case"true":case"false":return"boolean";case"set":case"include":case"null":return e;default:if(-1!=" abstract boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield ".indexOf(" "+e+" ")||"null"==e)throw Error("Reserved: "+e+" "+getPos(this.source,this.index));return"realId"}}],[/"(?:[^"\\]|\\[\s\S])*"|'(?:[^'\\]|\\[\s\S])*'/,function(e){return"string"}],[/\d+(?:\.\d+)?(?:e-?\d+)?/,function(e){return"number"}],[/{(?!{)/,function(e){return"{"}],[/}(?!})/,function(e){return"}"}],[function(e){e.sort().reverse();for(var r=0;r<e.length;++r)e[r]=e[r].replace(/[()*+?.[\]|]/g,"\\$&");return RegExp(e.join("|"))}(["!","%","&&","(",")","*","+","-",".","/","<","<=","=",">",">=","[","]","||","===","!==","==","!=",",",":","?"]),function(e){return/[*/%]/.test(e)?"mul":/[<>]/.test(e)?"rel":/[!=]=/.test(e)?"eq":e}]],createLexer({"":[[/(?:(?!{{)[\s\S])+/,function(e){return"text"}],[/{{{/,function(e){return this.pushState(e),e}],[/{{(?:\/if|else|\/each|\/forin|\/raw)}}/,function(e){return e}],[/{{#raw}}/,function(e){return this.pushState("raw"),e}],[/{{<script>[\s\S]*?<\/script>}}/,function(e){return"script"}],[/{{\*[\s\S]*?\*}}/],[/{{(?!\*)(?:#(?:if|each|forin)(?=\s))?/,function(e){return this.pushState("{{"),e}]],raw:[[/(?:(?!{{\/raw}})[\s\S])+/,function(e){return this.popState(),"rawtext"}]],"{{":Qa.concat([[/}}/,function(e){return this.popState(),e}]]),"{{{":Qa.concat([[/}}}/,function(e){return this.popState(),e}]])})),Qa,parse=(ib={nStart:43,tSymbols:["$","!","&&","(",")","+",",","-",".",":","=","?","[","]","boolean","eq","include","mul","null","number","rawtext","realId","rel","script","set","string","text","{","{{","{{#each","{{#forin","{{#if","{{#raw}}","{{/each}}","{{/forin}}","{{/if}}","{{/raw}}","{{else}}","{{{","||","}","}}","}}}","AdditiveExpression","ArrayLiteral","ConditionalExpression","ElementList","Elision","EqualityExpression","LogicalAndExpression","LogicalOrExpression","MemberExpression","MultiplicativeExpression","ObjectLiteral","PrimaryExpression","PropertyAssignment","PropertyNameAndValueList","RelationalExpression","UnaryExpression","_text","args","empty","expr","id","name","program","statement","statements","texts","program'"],actionList:[{_:-1},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,38:9,_:-32768},{_:-2},{26:11,32:12,_:-14},{_:-19},{1:38,3:34,7:39,12:36,14:33,16:29,18:35,19:32,21:31,24:28,25:30,27:37,_:0},{1:38,3:34,7:39,12:36,14:33,16:44,18:35,19:32,21:31,24:43,25:30,27:37,_:0},{_:-16},{_:-21},{20:46,_:0},{_:-20},{_:-29},{_:-47},{_:-31},{_:-32},{3:47,8:49,12:48,_:-54},{_:-57},{17:50,_:-59},{5:52,7:51,_:-62},{22:53,_:-64},{15:54,_:-66},{2:55,_:-68},{11:57,39:56,_:-70},{_:-72},{41:58,_:0},{_:-24},{_:-25},{_:-26},{_:-23},{_:-27},{_:-28},{_:-33},{6:64,13:63,_:-73},{16:29,21:31,24:28,25:69,40:70,_:0},{16:29,21:31,24:28,25:69,_:0},{41:75,_:0},{3:34,12:36,14:33,16:29,18:35,19:32,21:31,24:28,25:30,27:37,_:-24},{25:77,_:-25},{42:78,_:0},{36:79,_:0},{1:38,3:34,7:39,12:36,14:33,16:29,18:35,19:32,21:31,24:28,25:30,27:37,_:-73},{16:29,21:31,24:28,_:0},{_:-3},{4:94,_:0},{6:96,13:95,_:0},{1:38,3:34,6:98,7:39,12:36,14:33,16:29,18:35,19:32,21:31,24:28,25:30,27:37,_:0},{_:-34},{_:-40},{9:100,_:0},{_:-18},{6:101,40:102,_:0},{_:-44},{_:-17},{_:-42},{_:-55},{_:-56},{16:29,21:31,24:28,25:69,_:-73},{_:-12},{3:47,8:49,10:107,12:48,_:0},{41:108,_:0},{_:-13},{_:-22},{4:109,6:110,_:0},{_:-52},{4:111,_:0},{13:112,_:0},{_:-48},{_:-58},{17:50,_:-61},{17:50,_:-60},{5:52,7:51,_:-63},{22:53,_:-65},{15:54,_:-67},{2:55,_:-69},{9:113,_:0},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,35:115,37:116,38:9,_:0},{_:-30},{_:-35},{6:64,_:-73},{_:-36},{_:-41},{_:-37},{_:-43},{41:121,_:0},{41:122,_:0},{41:123,_:0},{41:124,_:0},{_:-15},{_:-50},{_:-51},{_:-49},{_:-4},{_:-5},{_:-3},{_:-46},{_:-45},{_:-3},{_:-3},{41:135,_:0},{_:-53},{_:-71},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,35:136,38:9,_:0},{_:-38},{_:-39},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,33:137,38:9,_:0},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,33:138,38:9,_:0},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,34:139,38:9,_:0},{23:10,26:11,28:8,29:6,30:7,31:5,32:12,34:140,38:9,_:0},{_:-11},{_:-6},{_:-7},{_:-8},{_:-9},{_:-10}],actionIndex:[0,1,2,3,4,5,5,5,6,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,5,31,32,33,5,5,34,34,35,36,37,38,39,40,5,41,5,5,5,5,5,5,5,5,42,43,44,45,5,46,47,48,49,50,51,52,53,54,55,56,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,5,34,82,83,84,85,86,5,87,88,5,89,90,5,91,92,93,45,5,94,95,96,96,97,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113],tGoto:[{65:1},{66:2,68:3,59:4},{},{59:13},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:27},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:40},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:41},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:42},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:45},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:59},{},{46:60,47:61,61:62},{64:65,63:66,56:67,55:68},{63:14,54:15,44:16,53:17,51:18,58:71},{63:14,54:15,44:16,53:17,51:18,58:72},{64:73,63:66},{64:74,63:66},{},{63:14,54:15,44:16,53:17,51:76},{},{},{},{63:14,54:15,44:16,53:17,51:18,60:80,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:81,61:82},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:83},{63:84},{63:14,54:15,44:16,53:17,51:18,58:85},{63:14,54:15,44:16,53:17,51:18,58:19,52:86},{63:14,54:15,44:16,53:17,51:18,58:19,52:87},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:88},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:89},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:90},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:91},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:92},{67:93},{},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:97},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:99},{},{},{},{},{},{},{},{},{},{},{64:103,63:66,61:104},{64:105,63:66,61:106},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{66:114,68:3,59:4},{},{},{47:117,61:118},{},{},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:119},{64:65,63:66,55:120},{},{},{},{},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:125},{},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:126},{},{},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:127},{},{},{67:128},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:129},{63:14,54:15,44:16,53:17,51:18,58:19,52:20,43:21,57:22,48:23,49:24,50:25,45:26,62:130},{},{},{67:131},{67:132},{67:133},{67:134},{},{},{},{66:114,68:3,59:4},{},{},{66:114,68:3,59:4},{66:114,68:3,59:4},{66:114,68:3,59:4},{66:114,68:3,59:4},{},{},{},{},{},{}],tRules:[[69,65],[65],[65,65,66],[67],[67,67,66],[66,31,62,41,67,35],[66,31,62,41,67,37,67,35],[66,29,62,64,64,41,67,33],[66,29,62,64,61,41,67,33],[66,30,62,64,64,41,67,34],[66,30,62,64,61,41,67,34],[66,28,24,51,10,62,41],[66,28,62,41],[66,38,62,42],[66,68],[66,28,16,25,41],[66,23],[64,25],[64,63],[68,59],[68,68,59],[59,26],[59,32,20,36],[63,21],[63,24],[63,16],[54,25],[54,19],[54,14],[54,63],[54,3,62,4],[54,44],[54,53],[54,18],[44,12,13],[44,12,46,13],[46,47,62],[46,61,62],[46,46,6,47,62],[46,46,6,61,62],[47,6],[47,47,6],[53,27,40],[53,27,56,40],[56,55],[56,56,6,55],[55,64,9,62],[51,54],[51,51,8,63],[51,51,12,62,13],[51,51,3,60,4],[51,51,3,61,4],[60,62],[60,60,6,62],[58,51],[58,1,58],[58,7,58],[52,58],[52,52,17,58],[43,52],[43,43,5,52],[43,43,7,52],[57,43],[57,57,22,43],[48,57],[48,48,15,57],[49,48],[49,49,2,48],[50,49],[50,50,39,49],[45,50],[45,50,11,45,9,45],[62,45],[61]],objCharset:null},function(e,r){for(var t=ib.nStart,n=ib.tSymbols,i={},u=0;u<n.length;++u)i[n[u]]=u;var o=ib.tAction||ib.actionList,s=ib.tGoto,c=ib.tRules,a=(ib.tCodes,ib.actionIndex);function f(e,r,t,n,i,u,o){return["each",r,u,n,t,!0]}function l(e,r,t,n,i,u,o){return["each",r,u,n,t,!1]}function p(e){return e.text}function h(e,r){var t;return(t=Array(e||0)).push(r),t}function _(e,r,t,n){var i;return t&&(e.length+=t),(i=e).push(n),i}function g(e){return[e]}function d(e,r,t,n){return["()",e,t]}function v(e,r,t){return[r.text,e,t]}var x=[,function(){return["prog",[],[]]},function(e,r){return e[1].push(r),e},function(){return[]},function(e,r){return e.push(r),e},function(e,r,t,n,i){return["if",r,n]},function(e,r,t,n,i,u,o){return["if",r,n,u]},f,f,l,l,function(e,r,t,n,i,u){return["set","id"==t[0]?t[1]:t,i]},function(e,r,t){return["eval",r,!1]},function(e,r,t){return["eval",r,!0]},function(e){return["text",e]},function(e,r,t,n){return["inc",evalStr(t.text)]},function(e){return["script",e.text.slice(10,-11)]},function(e){return evalStr(e.text)},p,function(e){return e},function(e,r){return e+r},p,function(e,r,t){return r.text},,,,function(e){return["lit",evalStr(e.text)]},function(e){return["lit",evalNum(e.text)]},function(e){return["lit","true"==e.text]},function(e){return["id",e.text]},function(e,r,t){return r},,,function(e){return["null"]},function(e,r){return["array",[]]},function(e,r,t){return["array",r]},h,h,_,_,function(e){return 1},function(e,r){return e+1},function(e,r){return["object",[]]},function(e,r,t){return["object",r]},g,function(e,r,t){return e.push(t),e},function(e,r,t){return["init",e,t]},,function(e,r,t){return[".",e,t.text]},function(e,r,t,n){return["[]",e,t]},d,d,g,function(e,r,t){var n;return(n=e).push(t),n},,function(e,r){return["!",r]},function(e,r){return["u-",r]},,v,,v,v,,v,,v,,v,,v,,function(e,r,t,n,i){return["cond",e,t,i]}];function m(e,r){return o[e][r]}function b(){return e.scan()}o.length,a&&(m=function(e,r){var t=o[a[e]];return t[r]||t._},a.length);var w=0,y=[0],E=b(),S=[],k={get:function(e){return S[S.length+e]},set:function(e,r){S[S.length+e]=r}};if(r)for(var u in r)k[u]=r[u];for(var A=S;;){A.length;var $=m(w,i[E.tag]);if(!$)break;if(0<$)y.push(w=$),S.push(E),E=b();else{if(!($<0&&-32768<$)){if(E.tag!=n[0])break;return S[0]}var C=-$,L=c[C],M=L.length-1;if(y.length-=M,w=s[y[y.length-1]][L[0]],y.push(w),x[C]){var j=x[C].apply(k,S.splice(S.length-M,M));S.push(j)}else 1!=M&&S.splice(S.length-M,M,null)}}for(var q=[],R=0;R<t;++R)m(w,R)&&q.push(n[R]);throw Error("Syntax error: "+E.pos+"\nfind "+E.tag+"\nexpect "+q.join(" "))}),ib;function isAtom(e){switch(e){case"id":case"lit":case"t":return!0}return!1}function isMember(e){return isAtom(e)||"."==e||"[]"==e}function isUnary(e){return isMember(e)||"!"==e||"u-"==e}function isMul(e){if(isUnary(e))return!0;switch(e){case"*":case"/":case"%":return!0}return!1}function isAdd(e){if(isMul(e))return!0;switch(e){case"+":case"-":return!0}return!1}function isRel(e){if(isAdd(e))return!0;switch(e){case"<":case">":case"<=":case">=":return!0}return!1}function isEquality(e){if(isRel(e))return!0;switch(e){case"eq":case"ne":return!0}return!1}function isLogicalAnd(e){return isEquality(e)||"&&"==e}function isLogicalOr(e){return isLogicalAnd(e)||"||"==e}function changeExt(e,r){return e.replace(/\.\w+$/,"."+r)}function isCond(e){return isLogicalOr(e)||"cond"==e}function codegen_js_tran(e,o,s,c){var r=0;function a(){return"_"+r++}function f(e){n.push(e)}function l(e,r){return e.pos=r,e}function t(e){switch(e[0]){case"if":f("if("),f(_(e[1])),f("){"),p(e[2]),f("}"),e[3]&&(f("else{"),p(e[3]),f("}"));break;case"each":var r=e[3]?encodeCommonName(e[3]):a(),t=h(i=_(e[1]));if(/^\w+$/.test(t))var n=t;else f("var "+(n=a())+" = "),f(i),f(";");e[5]?(f("for(var "+r+"=0;"+r+"<"),f(_([".",l(["t",n],e[1].pos),"length"])),f(";"+r+"++){")):f("for(var "+r+" in "+n+") {"),f("var "+e[4]+" = "),f(_(["[]",l(["t",n],e[1].pos),["t",r]])),f(";"),p(e[2]),f("}");break;case"set":"string"==typeof e[1]?f("var "+encodeCommonName(e[1])+"="):(f(_(e[1])),f("=")),f(_(e[2])),f(";");break;case"eval":var i;t=h(i=_(e[1]));if(/^\w+$/.test(t))var u=t;else u="_t",f("_t = "),f(i),f(";");f("if("+u+" !=null)_s += "+((s?!e[2]:e[2])?o+"("+u+")":u)+";");break;case"text":if(c&&/^\s+$/.test(e[1]))break;f("_s += "+quote(e[1])+";");break;case"inc":break;case"script":g.push(e[1]);break;default:throw Error("unknown stmt: "+e[0])}}function p(e){for(var r=0;r<e.length;++r)t(e[r])}function h(e){if("string"==typeof e)return e;if(e instanceof Array){for(var r=[],t=0;t<e.length;++t)r.push(h(e[t]));return r.join("")}throw new Error("unknown type")}function i(e,r){var t=_(e);return r&&!r(e[0])&&(t=["(",t,")"]),t}function _(e){return l(function(e){switch(e[0]){case"t":return e[1];case"id":return encodeCommonName(e[1]);case"lit":return"string"==typeof e[1]?quote(e[1]):String(e[1]);case"array":for(var r=["["],t=0;t<e[1].length;++t)0<t&&r.push(","),r.push(_(e[1][t]));return r.push("]"),r;case"object":for(var r=["{"],t=0;t<e[1].length;++t)0<t&&r.push(","),r.push(quote(e[1][t][1])),r.push(":"),r.push(_(e[1][t][2]));return r.push("}"),r;case"null":return["null"];case".":return[i(e[1],isMember),".",e[2]];case"[]":return[i(e[1],isMember),"[",_(e[2]),"]"];case"()":var n=[i(e[1],isMember),"("];if(e[2])for(var t=0;t<e[2].length;++t)0<t&&n.push(","),n.push(_(e[2][t]));return n.push(")"),n;case"!":return["!",i(e[1],isUnary)];case"u-":return["- ",i(e[1],isUnary)];case"*":case"/":case"%":return[i(e[1],isMul),e[0],i(e[2],isUnary)];case"+":case"-":return[i(e[1],isAdd),e[0]," ",i(e[2],isMul)];case"<":case">":case"<=":case">=":return[i(e[1],isRel),e[0],i(e[2],isAdd)];case"==":case"!=":case"===":case"!==":return[i(e[1],isEquality),e[0],i(e[2],isRel)];case"&&":return[i(e[1],isLogicalAnd),"&&",i(e[2],isEquality)];case"||":return[i(e[1],isLogicalOr),"||",i(e[2],isLogicalAnd)];case"cond":return[i(e[1],isLogicalOr),"?",i(e[2],isCond),":",i(e[3],isCond)];default:throw Error("unknown expr: "+e[0])}}(e),e.pos)}var n=[],g=[];p(e[1]);var u=[],d="";!function e(r){if("string"==typeof r&&(d+=r),r instanceof Array){r.pos&&u.push([d.length,r.pos]);for(var t=0;t<r.length;++t)e(r[t])}}(n),g.length&&(d+=g.join(";"));var v=new String(d);return v.posLog=u,v}function parsetmpl(e){return parse(Lexer(e))}function compile2jsfn(e,r){var t,n=parsetmpl(e);r&&(t=r.htmlEncode),e=codegen_js_tran(n,t||"_htmlEncode",!0,!(!r||!r.ignoreWhitespace));var i="";if(t||(i="var _obj = { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' };\tfunction _htmlEncode(s) {\t\treturn String(s).replace(/[<>&\"]/g, function(c) {\t\t\treturn _obj[c];\t\t});\t}"),i+="var _t,_s = '';",r&&r.debug){var u=e.posLog;i+="try{\n",i+="eval("+JSON.stringify(e)+");",i+="}catch(_e){throw "+function(e,r){for(var t,n=e.stack,i=n.split(/\r\n?|\n/),u=+/:(\d+):(\d+)\)$/m.exec(i[1])[2],o=null,s=0;s<r.length;++s)if(r[s][0]+1>=u){o=r[s][1];break}return Error("CroxError: "+("("+(t=o.pos).row+","+t.col+")")+"\n"+n)}+"(_e,"+JSON.stringify(u)+");}"}else i+=e;return i+="return _s;",Function("root",i)}var Crox={parse:parsetmpl,compile:compile2jsfn,render:function(e,r){return compile2jsfn(e)(r)}};function codegen_php_tran(e,s){function c(e){return"$crox_"+encodeCommonName(e)}function a(e){n+=e}function t(e){switch(e[0]){case"if":a("if("+l((o=e)[1])+"){"),f(o[2]),a("}"),o[3]&&(a("else{"),f(o[3]),a("}"));break;case"each":a("foreach("+l((u=e)[1])+" as "+(u[3]?c(u[3])+"=>":"")+c(u[4])+")"),a("{"),f(u[2]),a("}");break;case"set":a(c((i=e)[1])+" = "+l(i[2])+";");break;case"eval":a("crox_echo("+l((n=e)[1])+", "+(s?!n[2]:n[2])+");");break;case"text":t=(r=e)[1],/<\?(?:php)?|\?>/.test(t)?a("echo "+phpQuote(r[1])+";"):a("?>"+t+"<?php ");break;case"inc":a("include '"+changeExt(e[1],"php")+"';");break;default:throw Error("unknown stmt: "+e[0])}var r,t,n,i,u,o}function f(e){for(var r=0;r<e.length;++r)t(e[r])}function r(e,r){var t=l(e);return r&&!r(e[0])&&(t="("+t+")"),t}function l(e){switch(e[0]){case"id":return c(e[1]);case"lit":return"string"==typeof e[1]?phpQuote(e[1]):String(e[1]);case".":return r(e[1],isMember)+"->"+e[2];case"[]":return r(e[1],isMember)+"["+l(e[2])+"]";case"!":return"!crox_ToBoolean("+r(e[1],isUnary)+")";case"u-":return"- "+r(e[1],isUnary);case"*":case"/":case"%":return r(e[1],isMul)+e[0]+r(e[2],isUnary);case"+":return"crox_plus("+r(e[1],null)+", "+r(e[2],null)+")";case"-":return r(e[1],isAdd)+"- "+r(e[2],isMul);case"<":case">":case"<=":case">=":return r(e[1],isRel)+e[0]+r(e[2],isAdd);case"==":case"!=":case"===":case"!==":return r(e[1],isEquality)+e[0]+r(e[2],isRel);case"&&":return"crox_logical_and("+r(e[1],null)+", "+r(e[2],null)+")";case"||":return"crox_logical_or("+r(e[1],null)+", "+r(e[2],null)+")";default:throw Error("unknown expr: "+e[0])}}var n="";return f(e[1]),"<?php "==(n="?>"==n.slice(0,2)?n.slice(2):"<?php "+n).slice(-6)?n=n.slice(0,-6):n+="?>",n}function codegen_vm_tran(e){function i(e){return"$crox_"+encodeCommonName(e)}function u(e){return/^$\w+$/.test(e)}function o(e){r+=e}var s=0;function t(e){switch(e[0]){case"if":o("#if("+a(e[1])+")"),c(e[2]),e[3]&&(o("#{else}"),c(e[3])),o("#{end}");break;case"each":++s;var r=a(e[1]);if(u(r))var t=r;else o("#set ("+(t="$list"+(1==s?"":s))+" = "+r+")");e[5]?(o("#foreach("+i(e[4])+" in "+t+")"),e[3]&&o("#set("+i(e[3])+" = $velocityCount - 1)")):e[3]?(o("#foreach("+i(e[3])+" in "+t+".keySet())"),o("#set("+i(e[4])+" ="+t+".get("+i(e[3])+"))")):o("#foreach("+i(e[4])+" in "+t+")"),c(e[2]),o("#{end}"),--s;break;case"set":o("#set ("+i(e[1])+"="+a(e[2])+")");break;case"eval":var n=a(e[1]);u(n)?o("$!{"+n.slice(1)+"}"):o("#set($t = "+n+")$!{t}");break;case"text":o(e[1].replace(/\$/g,"$${dollar}").replace(/#/g,"$${sharp}"));break;case"inc":o("#parse('"+changeExt(e[1],"vm")+"')");break;default:throw Error("unknown stmt: "+e[0])}}function c(e){for(var r=0;r<e.length;++r)t(e[r])}function n(e,r){var t=a(e);return r&&!r(e[0])&&(t="("+t+")"),t}function a(e){switch(e[0]){case"id":return i(e[1]);case"lit":return"string"==typeof e[1]?-1==(r=e[1]).indexOf("'")?"'"+r+"'":"('"+r.split("'").join("'+\"'\"+'")+"')":String(e[1]);case".":return n(e[1],isMember)+"."+e[2];case"[]":return n(e[1],isMember)+"["+a(e[2])+"]";case"!":return"!"+n(e[1],isUnary);case"u-":if("u-"==e[1][0])throw Error("禁止两个负号连用");return"-"+n(e[1],isUnary);case"*":case"/":case"%":return n(e[1],isMul)+e[0]+n(e[2],isUnary);case"+":case"-":return n(e[1],isAdd)+e[0]+" "+n(e[2],isMul);case"<":case">":case"<=":case">=":return n(e[1],isRel)+e[0]+n(e[2],isAdd);case"==":case"!=":case"===":case"!==":return n(e[1],isEquality)+e[0].slice(0,2)+n(e[2],isRel);case"&&":return n(e[1],isLogicalAnd)+"&&"+n(e[2],isEquality);case"||":return n(e[1],isLogicalOr)+"||"+n(e[2],isLogicalAnd);default:throw Error("unknown expr: "+e[0])}var r}var r="#set($dollar='$')#set($sharp='#')";return c(e[1]),r}return Crox.compileToPhp=function(e){return codegen_php_tran(parsetmpl(e),!0)},Crox.compileToVM=function(e,r){return codegen_vm_tran(parsetmpl(e))},Crox.version="2.0.0",Crox}();"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=Crox:"function"==typeof define&&(define.amd||define.cmd)?define(function(){return Crox}):"undefined"!=typeof KISSY&&KISSY.add(function(){return Crox}),root&&(root.Crox=Crox)}(this);