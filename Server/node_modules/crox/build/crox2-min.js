/*!
 * Crox v2.0.0
 * https://github.com/thx/crox
 *
 * Released under the MIT license
 */

KISSY.add("crox",function(){function Class(t,n,r){function e(){}e.prototype=t.prototype;var o=new e;if(r)for(var u in r)o[u]=r[u];return n||(n=e),n.prototype=o,n}function Position(t,n){this.row=t,this.col=n}function getPos(t,n){var r=t.substring(0,n),e=r.match(/\r\n?|\n/g),o=1;return e&&(o+=e.length),new Position(o,1+/[^\r\n]*$/.exec(r)[0].length)}function Enum(t){for(var n={},r=0;r<t.length;++r)n[t[r]]=t[r];return n}function inArr(t,n){for(var r=0;r<t.length;++r)if(t[r]==n)return r;return-1}function inArr_strict(t,n){for(var r=0;r<t.length;++r)if(t[r]===n)return r;return-1}function nodup(t,n){n||(n=function(t,n){return t===n});for(var r=[],e=t.length,o=0;o<e;o++){for(var u=o+1;u<e;u++)n(t[o],t[u])&&(u=++o);r.push(t[o])}return r}function htmlEncode(t){return String(t).replace(/[&<>"]/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";default:return"&quot;"}})}function quote(t){return'"'+t.replace(/[\x00-\x1f"\\\u2028\u2029]/g,function(t){switch(t){case'"':return'\\"';case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t"}return"\\u"+("000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"'}function singleQuote(t){return"'"+t.replace(/[\x00-\x1f'\\\u2028\u2029]/g,function(t){switch(t){case"'":return"\\'";case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"\t":return"\\t"}return"\\u"+("000"+t.charCodeAt(0).toString(16)).slice(-4)})+"'"}function phpQuote(t){return"'"+String(t).replace(/['\\]/g,"\\$&")+"'"}function evalNum(t){return+t}function evalStr(s){return eval(s)}function encodeCommonName(t){return t.replace(/^_+/,"$&$&")}function createLexer(t){function g(t,n,r,e,o,u){this.tag=t,this.text=n,this.index=r,this.subMatches=e,this.end=o,this.pos=u}function i(){}function c(t){return"function"==typeof t?t:function(){return t}}function n(t){for(var n=1,r=[],e=[1],o=[],u=0;u<t.length;++u)e.push(n+=RegExp("|"+t[u][0].source).exec("").length),o.push(t[u][1]?c(t[u][1]):i),r.push("("+t[u][0].source+")");return[RegExp(r.join("|")+"|","g"),e,o]}g.prototype.toString=function(){return this.text};var x=t.$||"$",d={};for(var r in t)"$"!=r.charAt(0)&&(d[r]=n(t[r]));return function(c){var s=c.length,a=0,f=[""],l={text:"",index:0,source:c,pushState:function(t){f.push(t)},popState:function(){f.pop()},retract:function(t){a-=t}},_=new Position(1,1);function p(){var t=f[f.length-1],n=d[t],r=n[0];r.lastIndex=a;var e=r.exec(c);if(""==e[0]){if(a<s)throw Error("lexer error: "+_+"\n"+c.slice(a,a+50));return new g(x,"",a,null,a,_)}l.index=a,a=r.lastIndex;for(var o=n[1],u=0;u<o.length;++u)if(e[o[u]]){var i=n[2][u].apply(l,e.slice(o[u],o[u+1]));return new g(i,e[0],l.index,e.slice(o[u]+1,o[u+1]),a,_)}}var h=/\r\n?|\n/g;return{scan:function(){for(;;){var t=p(),n=_.row,r=_.col,e=t.text.match(h),o=e?e.length:0;if(n+=o,0==o)r+=t.text.length;else{for(var u,i=0,c=0,s=t.text.length;c<s;c++)"\r"!==(u=t.text.substr(c,1))&&"\n"!==u&&"\u2028"!==u&&"\u2029"!==u?i+=1:i=0;r=i+1}if(_=new Position(n,r),null!=t.tag)return t}},GetCurrentPosition:function(){return _},getPos:function(t){return getPos(c,t)}}}}Position.prototype.toString=function(){return"("+this.row+","+this.col+")"};var Lexer=(Qa=[[/\s+/],[/\/\/[^\r\n]*|\/\*[\s\S]*?\*\//],[/[A-Za-z_]\w*/,function(t){switch(t){case"true":case"false":return"boolean";case"set":case"include":case"null":return t;default:if(-1!=" abstract boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield ".indexOf(" "+t+" ")||"null"==t)throw Error("Reserved: "+t+" "+getPos(this.source,this.index));return"realId"}}],[/"(?:[^"\\]|\\[\s\S])*"|'(?:[^'\\]|\\[\s\S])*'/,function(t){return"string"}],[/\d+(?:\.\d+)?(?:e-?\d+)?/,function(t){return"number"}],[/{(?!{)/,function(t){return"{"}],[/}(?!})/,function(t){return"}"}],[function(t){t.sort().reverse();for(var n=0;n<t.length;++n)t[n]=t[n].replace(/[()*+?.[\]|]/g,"\\$&");return RegExp(t.join("|"))}(["!","%","&&","(",")","*","+","-",".","/","<","<=","=",">",">=","[","]","||","===","!==","==","!=",",",":","?"]),function(t){return/[*/%]/.test(t)?"mul":/[<>]/.test(t)?"rel":/[!=]=/.test(t)?"eq":t}]],createLexer({"":[[/(?:(?!{{)[\s\S])+/,function(t){return"text"}],[/{{{/,function(t){return this.pushState(t),t}],[/{{(?:\/if|else|\/each|\/forin|\/raw)}}/,function(t){return t}],[/{{#raw}}/,function(t){return this.pushState("raw"),t}],[/{{<script>[\s\S]*?<\/script>}}/,function(t){return"script"}],[/{{\*[\s\S]*?\*}}/],[/{{(?!\*)(?:#(?:if|each|forin)(?=\s))?/,function(t){return this.pushState("{{"),t}]],raw:[[/(?:(?!{{\/raw}})[\s\S])+/,function(t){return this.popState(),"rawtext"}]],"{{":Qa.concat([[/}}/,function(t){return this.popState(),t}]]),"{{{":Qa.concat([[/}}}/,function(t){return this.popState(),t}]])})),Qa,parse=function(t){function f(t,n){return e[t][n]}for(var l=t.nStart,_=t.tSymbols,p={},n=0;n<_.length;++n)p[_[n]]=n;var e=t.tAction,h=t.tGoto,g=t.tRules,x=t.tFuncs,o=t.actionIndex;return o&&(f=function(t,n){var r=e[o[t]];return r[n]||r._}),function(n,t){function r(t){throw Error("Syntax error: "+n.getPos(u.index)+(t?"\n"+t:""))}var e=0,o=[0],u=n.scan(),i=[],c={get:function(t){return i[i.length+t]},set:function(t,n){i[i.length+t]=n}};if(t)for(var s in t)c[s]=t[s];for(;;)if(s=f(e,p[u.tag]))if(0<s)o.push(e=s),i.push(u),u=n.scan();else{if(!(s<0&&-32768<s))return u.tag!=_[0]&&r(),i[0];var a=(e=g[s=-s]).length-1;o.length-=a,e=h[o[o.length-1]][e[0]-l],o.push(e),x[s]?(s=x[s].apply(c,i.splice(i.length-a,a)),i.push(s)):1!=a&&i.splice(i.length-a,a,null)}else{for(s=[],a=0;a<l;++a)f(e,a)&&s.push(_[a]);r("find "+u.tag+"\nexpect "+s.join(" "))}}}({nStart:37,tSymbols:["$","!","&&","(",")","+",",","-",".","=","[","]","boolean","eq","include","mul","number","rawtext","realId","rel","set","string","text","{{","{{#each","{{#forin","{{#if","{{#raw}}","{{/each}}","{{/forin}}","{{/if}}","{{/raw}}","{{else}}","{{{","||","}}","}}}","AdditiveExpression","EqualityExpression","LogicalAndExpression","LogicalOrExpression","MemberExpression","MultiplicativeExpression","PrimaryExpression","RelationalExpression","UnaryExpression","_text","args","epsilon","expr","id","name","program","statement","statements","texts"],tAction:[{_:-2},{_:-32768},{22:3,23:4,24:5,25:6,26:7,27:8,33:9,_:-1},{_:-19},{1:13,3:14,7:15,12:16,14:17,16:18,18:19,20:20,21:21,_:0},{1:13,3:14,7:15,12:16,14:33,16:18,18:19,20:34,21:21,_:0},{17:38,_:0},{_:-17},{_:-3},{22:3,27:8,_:-13},{_:-26},{21:44,_:-23},{_:-25},{_:-21},{14:33,18:19,20:34,_:-22},{_:-24},{5:46,7:47,_:-44},{13:48,_:-48},{2:49,_:-50},{34:50,_:-52},{3:51,8:52,10:53,_:-36},{15:54,_:-41},{_:-29},{19:55,_:-46},{_:-39},{35:56,_:0},{_:-27},{_:-23},{_:-22},{14:33,18:19,20:34,21:57,_:0},{35:61,_:0},{31:62,_:0},{36:63,_:0},{_:-18},{_:-37},{4:64,_:0},{_:-38},{35:65,_:0},{9:66,_:0},{1:13,3:14,7:15,12:16,14:33,16:18,18:19,20:34,21:21,_:-53},{14:33,18:19,20:34,_:0},{_:-11},{_:-15},{_:-16},{14:33,18:19,20:34,21:57,_:-53},{_:-20},{_:-12},{_:-28},{_:-14},{15:54,_:-42},{15:54,_:-43},{19:55,_:-47},{13:48,_:-49},{2:49,_:-51},{4:85,6:86,_:0},{4:87,_:0},{_:-34},{_:-30},{11:88,_:0},{_:-40},{5:46,7:47,_:-45},{35:89,_:0},{35:90,_:0},{35:91,_:0},{35:92,_:0},{22:3,23:4,24:5,25:6,26:7,27:8,30:93,32:94,33:9,_:0},{35:95,_:0},{_:-33},{_:-32},{_:-31},{_:-4},{_:-10},{_:-35},{22:3,23:4,24:5,25:6,26:7,27:8,28:102,33:9,_:0},{22:3,23:4,24:5,25:6,26:7,27:8,28:103,33:9,_:0},{22:3,23:4,24:5,25:6,26:7,27:8,29:104,33:9,_:0},{22:3,23:4,24:5,25:6,26:7,27:8,29:105,33:9,_:0},{22:3,23:4,24:5,25:6,26:7,27:8,30:106,33:9,_:0},{_:-6},{_:-7},{_:-8},{_:-9},{_:-5}],actionIndex:[0,1,2,3,4,5,5,5,6,5,7,8,9,5,5,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,29,30,31,32,33,34,35,36,37,38,5,5,5,5,5,39,40,5,5,5,41,42,43,44,44,0,45,46,47,48,5,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,5,68,69,0,0,0,0,70,0,71,72,73,74,75,76,77,78,79,80,81,82],tGoto:[{15:1,17:2},,{9:10,16:11,18:12},,{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:31,13:32},{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:35,13:32},{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:36,13:32},{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:37,13:32},,{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:39,13:32},,,{9:40},{4:26,6:28,8:41,13:32},{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:42,13:32},{4:26,6:28,8:43,13:32},,,,,{13:45},,,,,,,,,,,,,,,{13:58,14:59},{13:58,14:60},,,,,,,,,,{4:26,5:67,6:28,8:30,13:32},{4:26,5:68,6:28,8:30,13:32},{0:22,4:26,5:27,6:28,7:69,8:30,13:32},{0:22,1:70,4:26,5:27,6:28,7:29,8:30,13:32},{0:22,1:23,2:71,4:26,5:27,6:28,7:29,8:30,13:32},{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,10:72,11:73,12:74,13:32},{13:75},{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:76,13:32},{4:26,6:28,8:77,13:32},{0:78,4:26,5:27,6:28,8:30,13:32},,,,{11:79,13:58,14:80},{11:81,13:58,14:82},{17:83},,,,,{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:84,13:32},,,,,,,,,,,,,,,,,{9:10,16:11,18:12},,,{0:22,1:23,2:24,3:25,4:26,5:27,6:28,7:29,8:30,12:96,13:32},,,{17:97},{17:98},{17:99},{17:100},,{17:101},,,{9:10,16:11,18:12},{9:10,16:11,18:12},{9:10,16:11,18:12},{9:10,16:11,18:12},{9:10,16:11,18:12}],tRules:[[56,52],[52,54],[54],[54,54,53],[53,26,49,35,54,30],[53,26,49,35,54,32,54,30],[53,24,49,51,48,35,54,28],[53,24,49,51,51,35,54,28],[53,25,49,51,48,35,54,29],[53,25,49,51,51,35,54,29],[53,23,20,50,9,49,35],[53,23,49,35],[53,33,49,36],[53,55],[53,23,14,21,35],[51,21],[51,50],[55,46],[55,55,46],[46,22],[46,27,17,31],[50,18],[50,20],[50,14],[43,21],[43,16],[43,12],[43,50],[43,3,49,4],[41,43],[41,41,8,50],[41,41,10,49,11],[41,41,3,48,4],[41,41,3,47,4],[47,49],[47,47,6,49],[45,41],[45,1,45],[45,7,45],[42,45],[42,42,15,45],[37,42],[37,37,5,42],[37,37,7,42],[44,37],[44,44,19,37],[38,44],[38,38,13,44],[39,38],[39,39,2,38],[40,39],[40,40,34,39],[49,40],[48]],tFuncs:function(){function t(t,n){return t+n}function n(t,n,r,e,o,u,i){return makeLoop(n,u,e,r,!1)}function r(t,n,r,e,o,u,i){return makeLoop(n,u,e,r,!1)}function e(t){return t.text}function o(t){return t}function u(t,n,r,e){return t+"("+(r||"")+")"}function i(t,n,r){return t+n.text+r}return[,function(t){return Function("root","var _obj = { '<': '&lt;', '>': '&gt;', '&': '&amp;', '\"': '&quot;' };\tfunction _htmlEncode(s) {\t\treturn String(s).replace(/[<>&\"]/g, function(c) {\t\t\treturn _obj[c];\t\t});\t}var _t,_s = '';function _print(s,e){if(s!=null){if(e)s=_htmlEncode(s);_s+=s;}}"+t+"return _s;")},function(){return""},t,function(t,n,r,e,o){return"if("+n+"){"+e+"}"},function(t,n,r,e,o,u,i){return"if("+n+"){"+e+"}else{"+u+"}"},n,n,r,r,function(t,n,r,e,o,u){return"var "+encodeCommonName(r.text)+"="+o+";"},function(t,n,r){return"_print("+n+",1);"},function(t,n,r){return"_print("+n+");"},function(t){return"_print("+quote(t)+");"},function(t,n,r,e){throw Error("unimplemented: include")},function(t){return evalStr(t.text)},e,o,t,e,function(t,n,r){return n.text},,,,e,e,e,function(t){return encodeCommonName(t.text)},function(t,n,r){return"("+n+")"},,function(t,n,r){return t+"."+r},function(t,n,r,e){return t+"["+r+"]"},u,u,o,function(t,n,r){return t+","+r},,function(t,n){return"!"+n},function(t,n){return"- "+n},,i,,i,function(t,n,r){return t+"- "+r},,i,,i,,i,,i]}()}),i_tmake=0;function TMake(){return"_"+i_tmake++}function makeLoop(t,n,r,e,o){var u="",i=r?encodeCommonName(r):TMake(),c=t;if(/^\w+$/.test(c))var s=c;else u="var "+(s=TMake())+" = "+c+";";return u+="for(var "+i+(o?"=0;"+i+"<"+s+".length; ++"+i:" in "+s)+"){var "+e+" = "+s+"["+i+"];"+n+"}"}function compile(t){return i_tmake=0,parse(Lexer(t))}var Crox={compile:compile,render:function(t,n){return compile(t)(n)}};return Crox});